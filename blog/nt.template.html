<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{Title}{block:SearchPage} ({lang:Search results for SearchQuery}){/block:SearchPage}{block:PermalinkPage}{block:PostSummary} â€” {PostSummary}{/block:PostSummary}{/block:PermalinkPage}</title>
    {block:Description}
    <meta name="description" content="{MetaDescription}">
    {/block:Description}

    {block:Hidden}

    <meta name="text:Disqus shortname" content="">
    <meta name="text:Google analytics ID" content="">
    {/block:Hidden}

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" href="{Favicon}">
    <link rel="apple-touch-icon-precomposed" href="{PortraitURL-128}">
    <link rel="alternate" type="application/rss+xml" href="{RSS}">

    <link rel="stylesheet" type="text/css" href="http://static.tumblr.com/vr9xgox/PuGmmhqcs/normalize.css" />
    <link rel="stylesheet" type="text/css" href="http://static.tumblr.com/h4hpg15/KXqn6z3qw/main.css" />

    <style>{CustomCSS}</style>
</head>
<body>

<div id="top-container">

    <div id="header">

        <a href="/" class="menu left">

            <ul>
                <li class="icon umg"></li>
                <li class="logo"></li>
                <li class="tag">nerd.talk</li>
            </ul>

        </a>

        <div class="menu right clear">

            <ul>
                <li><a class="icon icon-social-state icon-facebook" href="http://www.facebook.com/ullisenmedia" target="_blank"></a></li>
                <li><a class="icon icon-social-state icon-twitter" href="http://twitter.com/ullisenmedia" target="_blank"></a></li>
                <li><a class="icon icon-social-state icon-gplus" href="http://plus.google.com/+ullisenmedia" target="_blank"></a></li>
                <li><a class="icon icon-www" href="http://ullisenmedia.com" target="_blank"></a></li>
                <li><a id="searchButton" class="icon search" href="#"></a></li>
            </ul>

        </div>

    </div>

    <form id="search" action="/search" method="get">
        <input type="text" name="q" id="q" placeholder="Search" autocomplete="false" autocorrect="false">
    </form>

</div>

<div id="expander"></div>

<div id="content-container">

    <div id="content">

        {block:SearchPage}
        {block:SearchResults}
        <p class="search-results">{lang:Your search for SearchQuery returned SearchResultCount results 2}</p>
        {block:SearchResults}



        {block:NoSearchResults}
        <div class="post">
            <div class="content">
                <p>{lang:No search results for SearchQuery 2}</p>
            </div>
        </div>
        {block:NoSearchResults}
        {/block:SearchPage}

        <div id="main-content" class="column">

            {block:Posts}
            {block:Text}
            <div class="post post-text">
                <div class="header">
                    <div class="title clear">
                        <h1><a href="{Permalink}" class="link">{Title}</a></h1>
                        <div class="icon-content-type comments"><span class="count"><a href="{Permalink}#disqus_thread" class="link dsq-comment-count">0</a></span></div>
                    </div>

                    <a href="{Permalink}" class="line-through"></a>

                </div>

                <h2>
                    <span><a href="#">Code:</a> Dart is so damn cool.</span>
                </h2>

                <div class="line dotted"></div>

                <p>{Body}</p>

                <div class="footer clear">

                    <div class="read-more"><span>Read: <a href="{Permalink}">More {Title}</a></span></div>
                    <div class="menu social clear">
                        <ul>
                            <li><a class="icon icon-facebook-nobg fb-share" href="#" data-url="http://www.facebook.com/sharer.php?u={Permalink}"></a></li>
                            <li><a class="icon icon-twitter-nobg twitter-share" href="#" data-url="https://twitter.com/share??original_referer={Permalink}&source=tweetbutton&text={Title}&url={Permalink}&via=ullisenmedian"></a></li>
                            <li><a class="icon icon-gplus-nobg gplus-share" href="#" data-url="https://plus.google.com/share?url={Permalink}"></a></li>
                        </ul>
                    </div>

                </div>
            </div>
            {/block:Text}
            {/block:Posts}

            {block:Pagination}
            <div id="paging-content">

                {block:NextPage}
                <a href="{NextPage}" class="page-btn prev uppercase"><span>{lang:Older entries}</span></a>
                {/block:NextPage}

                {block:PreviousPage}
                <a href="{PreviousPage}" class="page-btn next uppercase"><span>{lang:Newer Entries}</span></a>
                {/block:PreviousPage}

            </div>
            {/block:Pagination}


            {block:PermalinkPagination}
            <div id="paging-content">

                {block:NextPost}
                <a href="{NextPost}" class="page-btn next uppercase"><span>{lang:Next post}</span></a>
                {/block:NextPost}

                {block:PreviousPost}
                <a href="{PreviousPost}" class="page-btn prev uppercase"><span>{lang:Previous Post}</span></a>
                {/block:PreviousPost}

            </div>
            {/block:PermalinkPagination}

            {block:Permalink}
            <div id="comment-content">
                {block:IfDisqusShortname}
                <div id="disqus_thread"></div>
                <script type="text/javascript" src="http://disqus.com/forums/{text:Disqus Shortname}/embed.js"></script>
                <noscript><a href="http://{text:Disqus Shortname}.disqus.com/?url=ref">{lang:View the discussion thread}</a></noscript>
                {/block:IfDisqusShortname}
            </div>
            {/block:Permalink}

        </div>



        <div id="side-content" class="column">

            {block:Description}
            <div class="about">
                <h3>What is <span class="label">nerd.talk</span> ?</h3>
                <p>{Description}</p>
            </div>
            {/block:Description}

            <div class="recent-posts">
                <h3>Recent Posts</h3>
            </div>

            <div class="links">
                <h3>Links</h3>
                <ul>
                    <li><a href="/archive">Archive</a></li>
                    <li><a href="/rss">Rss</a></li>
                </ul>
            </div>

        </div>
    </div>

</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<script type="text/javascript">

    $('document').ready(function() {

        var searchForm;
        var searchButton;
        var searchField;

        var SEARCH_EXPAND_INCR = 34;
        var SEARCH_FIELD_MIN_WIDTH = 250;

        var SEARCH_BAR_MIN_HEIGHT = 0;
        var SEARCH_BAR_MAX_HEIGHT = 120;

        var EXPANDER_MIN_HEIGHT = 120;
        var EXPANDER_MAX_HEIGHT = 180;

        var SHARE_WINDOW_WIDTH = 'width=550,height=266';

        var init = function() {

            searchForm = $('#search');
            searchButton = $('#searchButton');
            searchField = $('#q');

            addListeners();
            getRecentPosts();
        };

        var getRecentPosts = function() {

            var url = 'http://nerdtalk.ullisenmedia.com/api/read/json?callback=?&filter=text&num=5';

//                var data = JSON.parse(recentPost);
//                buildRecentPosts(data.posts);

            $.getJSON(url, function(data) {

                if(data && data.hasOwnProperty('posts')) {

                    buildRecentPosts(data.posts);
                }

            });
        };

        var buildRecentPosts = function(posts) {

            var elements = [];

            $.each(posts, function(key, val) {

                console.log(val['regular-title']);
                elements.push('<li><a href="'+ val.url +'">'+ val['regular-title'] +'</a></li>');
            });

            $( "<ul/>", {
                "class": "recent-post-list",
                html: elements.join('')
            }).appendTo( ".recent-posts" );
        };

        var onSearchInputChange = function() {

            var text = searchField.val();

            var width = text.length * SEARCH_EXPAND_INCR;

            if(width > SEARCH_FIELD_MIN_WIDTH) {

                searchField.width(width);
            }

        };

        var onSearchButtonClicked = function() {

            var isActive = searchForm.height() > 0;

            if(isActive) {

                searchForm.height(SEARCH_BAR_MIN_HEIGHT);
                $('#expander').height(EXPANDER_MIN_HEIGHT);

            } else {

                searchForm.height(SEARCH_BAR_MAX_HEIGHT);
                $('#expander').height(EXPANDER_MAX_HEIGHT);
            }

        };

        var onShareButtonClicked = function(event) {

            var data = $(event.currentTarget).data();

            if(data.hasOwnProperty('url')) {

                window.open(data.url,'', SHARE_WINDOW_WIDTH);
            }

            return false;
        };

        var addListeners = function() {

            searchButton.click($.proxy(onSearchButtonClicked, this));
            searchForm.focusout($.proxy(onSearchButtonClicked, this))
            searchField.keypress($.proxy(onSearchInputChange, this));

            $('.fb-share').click($.proxy(onShareButtonClicked, this));
            $('.twitter-share').click($.proxy(onShareButtonClicked, this));
            $('.gplus-share').click($.proxy(onShareButtonClicked, this));
        };

        init();
    });


    var disqus_shortname = '{text:Disqus Shortname}';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);

    }());

</script>

</body>
</html>